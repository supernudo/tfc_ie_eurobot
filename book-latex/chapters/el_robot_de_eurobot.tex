%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Generic template for TFC/TFM/TFG/Tesis
%
% $Id: introduccion.tex,v 1.6 2014/02/11 11:00:06 macias Exp $
%
% By:
%  + Javier Macías-Guarasa.
%    Departamento de Electrónica
%    Universidad de Alcalá
%  + Roberto Barra-Chicote.
%    Departamento de Ingeniería Electrónica
%    Universidad Politécnica de Madrid
%
% Based on original sources by Roberto Barra, Manuel Ocaña, Jesús Nuevo,
% Pedro Revenga, Fernando Herránz and Noelia Hernández. Thanks a lot to
% all of them, and to the many anonymous contributors found (thanks to
% google) that provided help in setting all this up.
%
% See also the additionalContributors.txt file to check the name of
% additional contributors to this work.
%
% If you think you can add pieces of relevant/useful examples,
% improvements, please contact us at (macias@depeca.uah.es)
%
% Copyleft 2013
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{El robot de Eurobot}
\label{cha_el_robot_de_eurobot}

\begin{FraseCelebre}
  \begin{Frase}
Somos como enanos subidos a hombros de gigantes. Nuestra mirada puede abarcar más cosas y ver más lejos que ellos. No porque nuestra vista sea más penetrante y nuestra estatura mayor sino porque nos ha elevado su altura gigantesca.
  \end{Frase}
  \begin{Fuente}
Bernardo de Chatres, en \emph{Metalogicon} de Juan de Salisbury
  \end{Fuente}
\end{FraseCelebre}



%\section{Introducción}

Cada robot que participa en Eurobot es único y diferente al resto, sin embargo todos tienen en común ciertas características o funcionalidades que vienen determinadas o derivadas de las reglas del juego. Como se ha comentado en el capitulo \ref{cha_introduccion} cada año la prueba en la que competir o a resolver es diferente, esto tiene una implicación directa en el diseño mecánico especialmente en los mecanismos diseñados para manipular los elementos de juego propios de la prueba. Sin embargo, si se comparan las reglas del juego de varios años se observan características comunes que repercuten en el diseño de la mecánica, de la electrónica o del software.

\section{Especificaciones del robot de Eurobot}
\label{sec_especificaciones_del_robot_de_eurobot}

Un robot de Eurobot tiene especificaciones independientes de la temática del juego y otras dependientes totalmente. Las primera permiten que una vez estén desarrolladas y validadas puedan ser reutilizadas o mejoradas en futuros diseños. Esto quiere decir que pueden ser un bloque totalmente modular, por ejemplo una tarjeta electrónica, o diseños reutilizables como el diseño electrónico de la tarjeta, cuyo PCB\footnote{Del inglés \emph{Printed Circuit Board}, Tarjeta de Circuito Impreso} puede diseñarse a medida del robot y en función del espacio disponible.

Por otro lado, los sistemas mecánicos a diseñar para la manipulación de los elementos de juego son en su mayoría específicos de cada prueba. Sólo una pequeña parte del desarrollo relacionado con estos sistemas es reutilizable, como es parte del desarrollo software destinado al control de dichos sistemas mecánicos. 

Un robot de Eurobot ha de ser completamente autónomo y básicamente ser capaz de:

\begin{enumerate}
\item Desplazarse hasta las diferentes zonas del campo donde se sitúan los elementos del juego o donde se almacenan.
\item Evitar chocar con elementos del campo de juego y con otros robots oponentes durante los desplazamientos entre zonas del campo.
\end{enumerate}

Además, si las reglas permiten dos robots por equipo: un robot principal y uno secundario, es recomendable que ambos robots sean capaces de comunicarse entre sí con el fin jugar de forma cooperativa.

Con el fin de facilitar la detección entre los robots y que estos sean capaces de evitar colisiones entre ellos, los robots han de reservar un espacio para sensores y balizas a una altura determinada como muestra la figura \ref{fig_balizas_robots}. Así, cada robot puede colocar una baliza o marca en el robot oponente y disponer de un espacio donde situar los sensores apropiados para detectar dicha baliza. 

Estas balizas pueden ser activas o pasivas. Por ejemplo, un sistema compuesto por una baliza maciza y un sensor de ultrasonidos puede ser utilizado para detectar a que distancia y dirección se encuentra un robot oponente antes de tomar tomar la decisión de hacia donde redirigirse.

Además el campo de juego cuenta con 3 soportes para balizas adicionales que están a disposición de cada equipo (ver figura \ref{fig_balizas_campo}). Estos soportes están pensados para facilitar la localización de los robots en el campo de juego. Por ejemplo, un sistema compuesto por una baliza reflectante colocada en el soporte de una esquina del campo y un sensor de luz reflexivo en el robot puede ser utilizado para localizar una canasta que se encuentre en dicha esquina del campo.

Las balizas pueden ser activas o pasivas y tiene como únicas restricciones sus dimensiones y peso:

\begin{itemize}
\item Balizas colocadas en el oponente: dimensiones máximas de 80x80x80 cm y peso máximo de 0,5 Kg.
\item Balizas del campo de juego: dimensiones máximas de 160x80x80 cm.
\item Espacio para sensores en cada robot: 80x80x80 cm. 
\end{itemize}

\begin{figure}[ht]
\centering
\includegraphics[height=.27\textheight]{balizas_robots}
\caption[Altura de balizas y sensores]{Altura de balizas y sensores. Vista de perfil de dos robots oponentes y el campo de juego. 1- Soporte para balizas del campo de juego. 2- Soporte para baliza del oponente. 3- Espacio para sensores de balizas.}
\label{fig_balizas_robots}
\end{figure}

\begin{figure}[ht]
\centering
\includegraphics[height=.27\textheight]{balizas_campo}
\caption[Soportes para balizas del campo de juego de Eurobot]{Campo de juego de Eurobot 2015. Soportes para balizas fijas de los equipos A y B.}
\label{fig_balizas_campo}
\end{figure}

Por otro lado, el robot ha de ser capaz de resolver la temática del juego lo cual implica el manejo de los elementos o piezas propias del juego. Por ejemplo, en Eurobot 2015, juego titulado como \emph{Robomovies} (temática sobre el cine), una de las cosas por las que los robots obtenían puntos era por hacer una torre con piezas cilíndricas coronada con una pelota de tenis que simbolizaba un foco de cine. 

Además, mecánicamente un robot ha de cumplir las siguientes restricciones dimensionales:

\begin{itemize}
\item Perímetro máximo inicial 1200 mm (700 mm para el robot secundario)
\item Perímetro máximo desplegado 1500 mm (900 mm para el robot secundario)
\item Altura máxima de 350 mm
\end{itemize}


Por último, las reglas de Eurobot además especifican otros temas que deben de ser tenidos en cuenta en caso de que apliquen:

\begin{itemize}
\item Fuentes de alimentación y baterías
\item Utilización de fuentes de luz y láseres
\item Utilización de sistemas de comunicación de radio
\item Utilización de sistemas de aire comprimido
\item Botón de parada de emergencia
\item Método de comienzo y finalización de un partido
\item Procedimientos de un partido.
\end{itemize}

\section{Elementos del juego y tareas de un robot de Eurobot}
\label{sec_elementos_de_juego_y_tareas}

Los elementos de juego en Eurobot varían cada año con la temática. Se pueden identificar 2 tipos de elementos básicos:

\begin{itemize}
\item \textbf{Elementos no compartidos} 
Elementos que sólo pueden ser manipulados por cada robot contrincante y puntúan y pertenecen a cada robot. El número de elementos de este tipo es el mismo para cada robot. La manipulación de los elementos del robot oponente puede estar penalizada. 

\item \textbf{Elementos compartidos}
Elementos comunes a los robots contrincantes de un partido. Ambos robots pueden manipularlos y conseguir puntos por ellos, pero no pertenecen a ninguno, pueden ser utilizados por el contrincante sin penalización alguna.
\end{itemize}

Atendiendo a la posición de los elementos se obtiene la siguiente clasificación:

\begin{itemize}
\item \textbf{Elementos de posición conocida:}
La posición en el campo (coordenadas) es conocida a priori.

\item \textbf{Elementos de posición aleatoria:}
La posición en el campo es aleatoria entre varias posiciones posibles. Por ejemplo, en Eurobot 2016 la posición de las estrellas de mar era aleatoria. Previamente a la colocación de los elementos de juego por los árbitros echaban a suertes la posición de las estrellas de mar de cada robot.

\item \textbf{Elementos aportados por los robots:}
Algunos elementos pueden ser aportados por los robots al partido. Así al iniciar éste ciertos elementos pueden estar inicialmente en los robots. Por ejemplo, es el caso de unas pelotas de \emph{scuash} que el Eurobot 2005 los robots podían disparar para derribar las torres de bolos del oponente. 

\end{itemize}

Los elementos del juego suelen tener asociada una tarea por la cual se obtienen puntos en un partido. Dichas tareas simbolizan acciones relacionadas con la temática de la prueba. Se pueden identificar varios tipos de tareas atendiendo a su grado de complejidad: 

\begin{description}
\item \textbf{Accionar o empujar una palanca o mecanismo:}\\
Este tipo de tareas son las más sencillas, suele consistir en empujar un mecanismo simple. Por ejemplo, en Eurobot 2012 (\emph{Treasure Island}) los robots tenían que empujar un mecanismos, situado en una de las paredes del campo, por el cual se desplegaba un mensaje en rollado. Esto simbolizaba la acción de mandar un mensaje en una botella

\item \textbf{Recolectar y almacenar:}\\
Ciertas acciones consisten en recolectar elementos de juego y llevarlos hasta un sitio donde almacenarlos. Por ejemplo, en Eurobot 2015 (\emph{Robomovies}) los robots tenían que recolectar vasos de plástico con pelotas de poliestireno en su interior en su interior, que simbolizaban palomitas, y llevarlos hasta las zonas que simbolizaban los cines. Además, inicialmente los vasos no estaban completamente llenos de palomitas de forma que los robots podían ir hasta las máquinas de palomitas (unos dispensadores de pelotas) para rellenarlos y así conseguir más puntos.

\item \textbf{Recolectar selectivamente y almacenar:}\\
A veces, además de recolectar y almacenar elementos de juego, es necesario discriminar ciertos elementos que penalizan restando puntos. Es el caso de los frutos de Eurobot 2014 (\emph{Prehistobot}), de entre los frutos (corchos morados) que colgaban de los árboles había 2 colocados de forma aleatoria que eran tóxicos (corchos negros).

\item \textbf{Recolectar y construir:}\\
Este tipo de tareas consisten en construir un elemento de juego a partir de piezas de éste que son recolectadas por el campo. Por ejemplo, en Eurobot 2009 (\emph{Temples of Atlantis}) los robots tenían que recolectar partes de columnas (fichas cilíndricas) y linteles (fichas rectangulares) para construir templos de dos columnas lo más altos posibles.

\item \textbf{De habilidad:}\\
Algunos años los robots han tenido que demostrar cuanto de hábiles son desafiando la gravedad. Por ejemplo, en Eurobot 2015 (\emph{Robomovies}) los robots obtenían puntos por subir unas escaleras en las que previamente habían extendido la alfombra roja. O por ejemplo en Eurobot 2011 (\emph{Chess'Up!}), donde los robots tenían que acabar sentados sobre una de las fichas que simbolizaban peones de Ajedrez en su casilla de salida.

\item \textbf{\emph{Funny acction}:}\\
La \emph{Funny acction} es una acción que está pensada para ser realizada por los robots al finalizar el partido. Por ejemplo, en Eurobot 2016 (\emph{The Beach Bots}) al finalizar el partido los robots tenían que desplegar una sombrilla o toldo que llevaban consigo para protegerse del sol.

\end{description}


\section{Partes principales en el desarrollo de un robot de Eurobot}
\label{sec_partes_robot_eurobot}

Teniendo en cuenta las especificaciones descritas en la sección anterior y la temática de la prueba de Eurobot, el desarrollo de un robot de Eurobot se puede dividir en las siguientes partes principales:

\begin{enumerate}
\item Estrategia de juego.
\item Desplazamiento y localización.
\item Evitación de obstáculos.
\item Comunicación entre robots (en caso de jugar con 2 robots).
\item Manipulación de elementos de juego. 
\end{enumerate}

Así, tal y como representa la figura \ref{fig_partes_robot_eurobot}, un único robot está compuesto por las tres primera partes y sólo en caso de contar con 2 o más robots es necesaria la parte de comunicación entre robots. 

\begin{figure}[h]
\centering
\includegraphics[height=.4\textheight]{partes_robot_eurobot}
\caption[Partes principales del desarrollo de un robot de Eurobot]{Partes principales del desarrollo de un robot de Eurobot. En el fondo robot P.Tinto y Tirantes (robot secundario) desarrollados para Eurobot 2015 por el equipo Eurobotics Engineering}
\label{fig_partes_robot_eurobot}
\end{figure}

Por otro lado, las partes 2, 3 y 4 forman lo que se ha denominado \emph{plataforma robótica base}. Esta plataforma base está compuesta por las partes que permiten un desarrollo independientemente de la temática de la prueba de Eurobot. Así, esta plataforma robótica constituye un desarrollo reutilizable en la concepción de nuevos robots de Eurobot. 

Cada una de estas partes principales de un robot de Eurobot tienen pueden implicar un desarrollo mecánico, electrónico y de software, dependiendo del caso.


\subsection{Estrategia de juego}
\label{sec_estrategia_de_juego}

La estrategia de juego constituye el nivel más abstracto del robot y tiene un desarrollo puramente software. La estrategia tiene en cuenta diferentes variables del juego como se indica en la figura \ref{fig_variables_estrategia}(tareas por realizar, prioridad de tareas, posición del oponente, el tiempo transcurrido de partido, etc.) para tomar decisiones que maximicen la puntuación a conseguir y así ganar el partido.

\begin{figure}[h]
\centering
\includegraphics[width=.8\textwidth]{variables_estrategia}
\caption[Estrategia de juego: variables a tener en cuenta en la toma de decisiones]{Estrategia de juego: variables a tener en cuenta en la toma de decisiones.}
\label{fig_variables_estrategia}
\end{figure}

El desarrollo de la estrategia puede ser realizado en paralelo a otras partes del robot, pero ha de tener en cuenta los tiempos derivados de tareas que impliquen sistemas mecánicos, como por ejemplo coger una pelota y almacenarla o desplazarse de un punto del campo a otro. Dichos tiempos por lo general son mucho mayores (segundos o decenas de segundos) que el tiempo que tarda el algoritmo de estrategia implementado en tomar una decisión. Es por ello que dicho algoritmo estará la mayor parte del tiempo esperando a que otras partes terminen de realizar su función.

\subsection{Desplazamiento y localización}
\label{sec_desplazamiento_y_localizacion}

Un robot de Eurobot está diseñado para funcionar en un entorno de dimensiones conocidas como es el campo de juego (un área de 2x3 m), o lo que es lo mismo un plano cartesiano. Así la posición del robot y otros objetos del campo, como elementos de juego o los robots oponentes, vendrá dada por sus coordenadas rectangulares $(x,y)$ y polares $(d,a)$ relativas a un origen de coordenadas $(0,0)$ (ver figura \ref{fig_ejemplo_campo_cartesiano_y_trayectorias}).

La localización permite al robot conocer su posición $(x_R,y_R)$ en el campo y poder calcular las distancias (rectangulares o polares) de un punto de destino $(x_i,y_i)$ relativas a su posición. El desplazamiento permite recorrer dichas distancias a una velocidad $v$ y aceleración $a$ determinadas generando así \emph{trayectorias}.

\begin{figure}[h]
\centering
\includegraphics[width=.6\textwidth]{ejemplo_campo_cartesiano_y_trayectorias}
\caption[Representación cartesiana del campo de Eurobot 2015 y ejemplo de generación de trayectorias]{Representación cartesiana del campo de Eurobot 2015 (ver figura \ref{fig_ejemplo_campo_cartesiano_y_trayectorias}) y ejemplo de generación de trayectorias. En horizontal el eje $x[mm]$, vertical el eje $y[mm]$. Los cuadrados rojos representan obstáculos y el cuadrado azul de rayas la zona útil de desplazamiento del robot. El punto azul grande con flecha indica la posición de inicio y los puntos azules grandes sin flecha indican un punto de destino. Los puntos azules pequeños indican puntos de la trayectoria.}
\label{fig_ejemplo_campo_cartesiano_y_trayectorias}
\end{figure}

Mecánicamente es necesario desarrollar un sistema de tracción, que en el caso de los robots desarrollados es un \emph{sistema de tracción diferencial}. Dicho sistema está compuesto por dos motores con reductora que mueven dos ruedas independientes que están en contacto con el campo de juego. Además para poder \emph{controlar velocidad y aceleración} de cada rueda se utilizan sensores tipo \emph{encoder} que miden cuanto gira cada rueda, o lo que es lo mismo su posición angular relativa. Utilizando la información medida por los encoders (u otro sistema similar) es posible medir la posición del robot de forma relativa a una posición de inicio mediante \emph{algoritmos de odometría}\footnote{De forma complementaria se pueden utilizar sistemas de medida de posición absoluta para corregir los errores de las medidas relativas}.

Como muestra la figura \ref{fig_desplazamiento_y_localizacion_bloques} la electrónica asociada ha de contar con una etapa de electrónica de potencia que permita la excitación de los motores (\emph{drivers} de motores), el acondicionamiento y decodificación de las señales de los encoders, y un microcontrolador donde se implementen los algoritmos de control de posición, velocidad y aceleración de los motores, y el algoritmo de odometría.

\begin{figure}[h]
\centering
\includegraphics[width=.7\textwidth]{desplazamiento_y_localizacion_bloques}
\caption[Desplazamiento y localización: diagrama de bloques de las partes a desarrollar]{Desplazamiento y localización: diagrama de bloques del desarrollo mecánico, electrónico y software implicado.}
\label{fig_desplazamiento_y_localizacion_bloques}
\end{figure}

Dicho microcontrolador, además de implementar los algoritmos específicos de control de motores y odometría, ha de implementar funciones mucho más abstractas como la \emph{generación de trayectorias}. De forma que en última medida, el robot pueda desplazarse a un punto del campo de juego de forma autónoma o seguir un camino compuesto por varios puntos como el representado en la figura \ref{fig_ejemplo_campo_cartesiano_y_trayectorias}.

\subsection{Evitación de obstáculos}
\label{sec_evitacion_de_obstaculos}

El robot de Eurobot se encuentra con dos tipos de obstáculos a evitar en sus trayectorias. Por un lado están los obstáculos fijos y de posición conocida como pueden ser partes del campo de juego o elementos de juego al inicio del partido. Y por otro lado, objetos de posición desconocida como son los robots oponentes o elementos de juego que han sido movidos de su posición inicial.

La evitación de obstáculos está directamente relacionada con la generación de trayectorias del robot, teniéndose en cuenta previamente al calculo de la trayectoria a realizar y durante la misma. Los sistemas de detección de obstáculos a desarrollar dependen de las diferente situaciones que se dan en un partido de Eurobot:

\begin{description}
\item \textbf{Obstáculo en trayectoria:}

Es el caso en el que el robot quiere ir de una zona del campo a otra, por ejemplo para coger o dejar un elemento de juego. El camino a seguir hasta la zona de destino ha de tener en cuenta los espacios libres del campo de juego y la posición de los robots oponentes para así seguir trayectorias libres de obstáculos. Como muestra el ejemplo de la figura \ref{fig_ejemplo_trayectorias_y_evitacion}, entre el punto origen y destino además de los objetos fijos del campo de juego se encuentra el robot oponente. La generación de trayectorias tiene en cuenta estos obstáculos y genera trayectorias que rodean los obstáculos siguiendo el camino más corto.


\begin{figure}[h]
\centering
\includegraphics[width=.6\textwidth]{ejemplo_trayectorias_y_evitacion}
\caption[Ejemplo de evitación de obstáculos en trayectorias]{Evitación de obstáculos en trayectorias. En el centro un robot oponente. En horizontal el eje $x[mm]$, vertical el eje $y[mm]$. Los cuadrados rojos representan obstáculos y el cuadrado azul de rayas la zona útil de desplazamiento del robot. El punto azul grande con flecha indica la posición de inicio y los puntos azules grandes sin flecha indican un punto de destino. Los puntos azules pequeños indican puntos de la trayectoria.}
\label{fig_ejemplo_trayectorias_y_evitacion}
\end{figure}


La evitación los obstáculo fijos del campo de juego se puede realizar utilizando la \emph{localización del robot}. Si el robot conoce su posición es sencillo evitar chocar con paredes o elementos fijos del campo de juego.

Respecto a la evitación y detección de los robots oponentes es necesario desarrollar un sistema específico para ello. Este sistema normalmente utiliza los soportes de balizas especificado por las reglas de Eurobot (ver figura \ref{sec_especificaciones_del_robot_de_eurobot}). Dependiendo del sistema de balizas utilizado \cite{balizas_y_cerveza} el desarrollo del mismo implicará en mayor o mejor medida un desarrollo mecánico, electrónico o software. 

Sea cual sea el sistema utilizado para localizar al robot oponente, debe de aportar la información de la posición del éste de forma relativa a la posición del robot (ver ejemplo de la figura \ref{fig_medida_posicion_oponente} o absoluta respecto al origen de coordenadas del campo de juego. Además otras características deseables son un rango de detección que cubra todo el campo de juego y un tiempo de medición de la posición del oponente pequeño. El conocer en todo momento la posición del oponente constituye una información muy valiosa a tener en cuenta en la estrategia de juego. Así mismo, un tiempo de medición pequeño permitirá un menor tiempo de reacción en caso de peligro de colisión.

\begin{figure}[h]
\centering
\includegraphics[width=.7\textwidth]{medida_posicion_oponente}
\caption[Ejemplo de sistema de medida de la posición del robot oponente basado en balizas]{Ejemplo de sistema de medida de la posición del robot oponente que utiliza una baliza colocada en el oponente y un sensor en el robot. La medida obtenida es el ángulo y la distancia relativa al la posición del robot.}
\label{fig_medida_posicion_oponente}
\end{figure}


\item \textbf{Obstáculo inesperado en una trayectoria:}

Iniciada una trayectoria, que a priori no tiene obstáculos, en cualquier punto de esta puede ocurrir que el robot oponente cambie su posición y se interponga en el camino del robot pudiendo producirse una colisión. En este caso, el robot ha de detectar este obstáculo inesperado y parar o modificar su trayectoria para evitar la colisión.

La detección de un objeto inesperado en una trayectoria se puede realizar utilizando el mismo sistema desarrollado para localizar al robot oponente, si el rango de medida cubre distancias cercanas al robot y el tiempo de medida es suficientemente pequeño respecto a la velocidad de desplazamiento del robot. Aún así, un segundo sistema más especifico para estos casos aumenta la fiabilidad y permite hacer una doble comprobación si los rangos de detección de ambos sistemas se solapan.

El sistema a desarrollar permite detectar un objeto cercano (0 a 30cm aproximadamente) en las dirección de avance del robot (parte delantera y trasera) y opcionalmente detectar un objeto situado a los lados del robot (lado izquierdo y derecho). El rango depende de principalmente de la distancia de frenado del robot a velocidad máxima, de forma que la detección de un objeto permita evitar la colisión. 

Suelen utilizarse sensores digitales de luz difusa (luz roja o infrarrojos) situados estratégicamente a una altura determinada. En parte delantera y trasera del robot tres sensores son suficientes para detectar un objeto (dos si el robot es estrecho), dos de ellos se sitúan en los extremos de del robot y si fuera necesario un tercero en el punto medio entre ellos (ver figura \ref{fig_deteccion_obstaculo_en_trayectoria}). Para la detección de objetos a izquierda y derecha del robot un sensor a cada lado es suficiente. El fundamento es simple, si cualquiera de los dos sensores de los extremos de robot detecta un objeto hay posibilidad de colisión.

\begin{figure}[h]
\centering
\includegraphics[width=.7\textwidth]{deteccion_obstaculo_en_trayectoria}
\caption[Ejemplo de sistema de detección de obstáculos en trayectoria]{Ejemplo de sistema de detección de obstáculos en trayectoria. Tres sensores de corta distancia digitales detectan posibles colisiones.}
\label{fig_deteccion_obstaculo_en_trayectoria}
\end{figure}


\item \textbf{Obstáculo que bloquea un elemento del juego:}

Caso en el que el robot se encuentra en una zona desde donde necesita acceder a un elemento de juego, por ejemplo un dispensador de fichas. Puede ocurrir que uno de los elementos de juego, por ejemplo una pelota u otro elemento, se encuentre entre el robot y el dicho dispensador. La probabilidad de que ocurra esto es mayor con los objetos esféricos y de poco peso, como por ejemplo pelotas de \emph{ping pong}, la manipulación de los mismos puede hacer que éstos rueden a lo largo del campo aleatoriamente con facilidad\footnote{Este tipo de objetos también puede entrar dentro de los sistemas mecánicos del robot e inutilízalos o bloquearlos}. 

Otro caso, que se suele dar muy pocas veces, es que el robot oponente esté protegiendo un elemento de juego común de forma premeditada utilizando otro elemento de juego, con el fin de dificultar su acceso al otro robot.

En el caso de que un objeto se encuentre entre un elemento fijo del campo, como una pared, y el robot. Si el robot necesita utilizar dicha pared como referencia y un objeto se encuentra en medio, la referencia que medirá el robot será errónea, así como los movimientos que realice respecto a esa referencia. Esta situación se puede prevenir si el robot es capaz de limpiar previamente la zona a la que quiere acceder realizando realizando secuencias de movimientos específicas para ello, o si el objeto bloqueante es detectado mediante sensores.

Una tercera forma de detectar un objeto bloqueante es utilizando la localización del robot, su posición y el error estimado de la misma. Si en el momento de tomar la referencia de la pared la posición medida por la localización del robot es mayor que el error estimado (en distancia o ángulo) algo está impidiendo llegar hasta la posición de referencia.

\end{description}

\subsection{Comunicación entre robots}
\label{sec_comunicacion_entre_robots}

En caso de disponer de dos robots por equipo hay diferentes formas de implementar una estrategia coordinada:

\begin{enumerate}
\item Que cada robot tenga asignado un área del campo de forma que no se estorben.
\item Que cada robot se mueva libremente por todo el campo y considere al robot compañero como un obstáculo más.
\item Que exista una comunicación entre ambos de forma que cada uno conozca la posición del otro trabajen en cualquier zona del campo pero sin estorbarse.
\end{enumerate}

Las dos primeras formas no implican un desarrollo añadido, los mismos sistemas de localización, desplazamiento y evitación de obstáculos desarrollados para un robot pueden replicarse en un segundo robot sin apenas coste añadido, excepto por aquel derivado de sus características mecánicas (diferente dimensiones, motores, sistemas mecánicos...).

La tercera forma necesita del desarrollo de un sistema de comunicación entre ambos robots. Esto implica un desarrollo electrónico y de software principalmente. Es recomendable utilizar una tecnología que robusta y flexible que incluya capas de comunicación que aseguren una fiabilidad en la comunicación. Sobre todo porque el entorno en el que se desarrollan las competiciones suele tener muchas perturbaciones de radio frecuencia como equipos de audio y vídeo inalámbricos, redes Wifi o Bluetooth que pueden afectar a la comunicaciones entre los robots. 

Como representa la figura \ref{fig_comunicacion_entre_robots}, cada robot necesita de un modulo de comunicación conectado a un microcontrolador. Bluetooth y Zigbee son dos de las tecnologías más utilizadas en comunicación inalámbrica, existen en el mercado módulos de comunicación de estas tecnologías que permiten crear enlaces de comunicación de forma sencilla. Dichos módulos electrónicos suelen tener una interfaz serie de comunicación (UART, SPI, I2C, ...) de forma que una vez establecido el canal de comunicación inalámbrico la comunicación entre dos microcontroladores es trasparente (similar a tener un canal cableado). 

\begin{figure}[h]
\centering
\includegraphics[width=\textwidth]{comunicacion_entre_robots}
\caption[Diagrama de bloques del sistema de comunicación entre robots]{Sistema de comunicación entre robots. Ejemplo de diagrama de bloques de las diferentes capas HW y SW de la comunicación. De forma virtual existe una comunicación a nivel de cada capa software entre ambos robots.}
\label{fig_comunicacion_entre_robots}
\end{figure}

Por la parte del software, es necesario desarrollar un protocolo de comunicación, común a los dos robots, a partir del cual enviar y/o recibir mensajes entre ellos.


\subsection{Manipulación de elementos de juego} 
\label{sec_manipulación_de_elementos_de_juego}

En una prueba de Eurobot la forma de conseguir puntos consiste en realizar ciertas tareas que implican la manipulación de elementos de juego. Las acciones a realizar con dichos elementos pueden ser recolectar, almacenar, clasificar y realizar construcciones, entre otras. Dicha manipulación suele ser realizada mediante sistemas mecánicos desarrollados expresamente para la prueba. Se ha considerado que cada sistema mecánico puede estar compuesto por uno o varios mecanismos, y estos a su vez formados por varios actuadores y sensores. 

\begin{figure}[h]
\centering
\includegraphics[width=.8\textwidth]{sistema_stands}
\caption[Mecanismos del sistema mecánico de \emph{stands} del robot P.Tinto (Eurobot 2015)]{Sistema mecánico de \emph{stands} del robot P.Tinto (Eurobot 2015) formado por varios mecanismos. Cada mecanismo esta formado por uno varios actuadores (motores y servomotores) y sensores.}
\label{fig_sistema_stands}
\end{figure}


Por ejemplo como muestra la figura \ref{fig_sistema_stands}, el sistema de \emph{stands} del robot P.Tinto (desarrollado para Eurobot 2015) estaba compuesto por un mecanismo de puertas, un mecanismo clasificador, 2 mecanismos tipo pinza, 2 tipo ascensor y un mecanismo tipo carro. Este sistema era capaz de clasificar y almacenar de forma apilada elementos tipo \emph{stands} en dos torres y posteriormente construir una torre única. La torre junto con una pelota de tenis en su parte superior (bombilla) simbolizaba un foco de cine, cuanto mayor altura tenia el foco mayor era la puntuación obtenida.

Al igual de la estrategia de juego (ver sección \ref{sec_estrategia_de_juego}), la manipulación de elementos de juego constituye un desarrollo específico de cada prueba de Eurobot. En este caso el desarrollo es principalmente mecánico, aunque necesita además de un desarrollo electrónico y de software. Dicho desarrollo se muestra representado en la figura \ref{fig_diagrama_bloques_mecanica}.

\begin{figure}[h]
\centering
\includegraphics[width=.8\textwidth]{diagrama_bloques_mecanica}
\caption[Diagrama de bloques del las partes a desarrollar en un sistema mecánico]{Diagrama de bloques genérico de las partes a desarrollar en un sistema mecánico destinado a la manipulación de elementos de juego.}
\label{fig_diagrama_bloques_mecanica}
\end{figure}

%Los sistemas mecánicos suelen estar compuestos por mecanismos movidos por actuadores y realimentados mediante sensores. Los actuadores más comunes son los eléctricos (servomotores y motores), aunque se pueden utilizar actuadores neumáticos o hidráulicos (menos comunes). Los sensores más utilizados suelen ser de contacto y ópticos, aunque cabe la posibilidad de utilizar de cualquier otro tipo (magnético, inductivo, de ultrasonidos,...).

La manipulación de elementos de juego necesita estar sincronizada con los movimientos de desplazamiento del robot, es por ello que es recomendable destinar un microcontrolador independiente para la gestión y control de los sistemas mecánicos.


\section{Objetivos del desarrollo de un robot de Eurbot}

Antes de nada hay que recordar que el desarrollo de un robot de Eurobot y la competición en sí misma tiene como objetivo la experimentación, el aprendizaje y compartición del conocimiento científico y de ingeniería que implica la robótica. Independientemente del resultado de la competición para un equipo, el beneficio que obtiene cada uno de los integrantes es el aprendizaje, la experiencia y el disfrute del proceso de desarrollo del robot. El desarrollo de un robot de Eurobot no supone un desarrollo de un producto comercial o similar que lleve implícito una ganancia económica puesto que ni siquiera ganar la competición tiene un premio económico. 

Es muy recomendable que el equipo que va ha desarrollar los robots fijen unos objetivos comunes (a ser posible de forma escrita) de forma que focalicen sus esfuerzos en ellos. Unos objetivos realistas suelen tener resultados  satisfactorios, consiguiendo disfrutar del proceso de desarrollo del robot y de la competición. La experiencia dice que esto nunca es así, ya que la escasez de tiempo suele implicar esfuerzos extra en el desarrollo lo cual implicar un menor disfrute. Aun así, intentar conseguir completar el 100\% de unos objetivos realistas con un 20\% menos de disfrute merece la pena.

Si no se dispone de suficiente experiencia, tiempo y recursos humanos, es recomendable empezar con un desarrollo que implique una mecánica sencilla y focalizar el desarrollo en las partes que forman lo que se ha denominado la \emph{plataforma robótica base} (ver \ref{sec_partes_robot_eurobot}) y en la estrategia de juego. Una vez se tenga desarrollada una plataforma base reutilizable, el desarrollo puede centrarse más en la parte mecánica y de estrategia. En cualquier caso, aunque se desarrolle un robot que sea capaz de realizar todas las tareas del juego siempre quedaran partes que mejorar o nuevas tecnologías con las que experimentar y aprender.

%Topolino Vs. Trompetero

Resulta muy interesante comparar el desarrollo de robot Topolino (2008) con el del robot Trompetero (2010) (ver figura \ref{fig_robots_topolino_y_trompetero}. Ambos robots fueron desarrollados principalmente por las dos mismas 2 personas\footnote{Diego Salazar y Javier Baliñas}: una persona dedicada a la mecánica y una dedicada a la electrónica y software. Topolino (figura \ref{fig_robot_topolino} se construyó sobre una una plataforma robótica desarrollada anteriormente\footnote{Desarrollada por Diego Salazar, Marcelo Salazar y Sergio Arroyo}. Así se disponía casi por completo de las partes de desplazamiento y localización del robot, además de un chasis sobre el que construir la mecánica específica de la prueba de Eurobot. El desarrollo se centró en un diseño mecánico muy sencillo y de bajo coste, en la implementación de un sistema de evitación de obstáculos, en la estrategia y en la manipulación de los elementos de juego. El resultado fue muy satisfactorio, se llegó a realizar casi el 100\% de los objetivos del robot, se obtuvo una buena clasificación en la competición e incluso Topolino ganó el premio \emph{Mejor concepto de robot}\footnote{Premio otorgado a robots que implementan soluciones originales y recursos materiales modestos}. Y lo más importante, los desarrolladores disfrutaron del proceso hasta el final.

\begin{figure}[h]
\centerline{
	\subfloat[Robot Topolino (2008)]{\includegraphics[height=.2\textheight]{topolino}
	\label{fig_robot_topolino}}
	\hfil
	\subfloat[Robot Trompetero (2010)]{\includegraphics[height=.2\textheight]{trompetero}
	\label{fig_robot_trompetero}}
}
\caption[Robots Topolino y Trompetero]{Robots desarrollados para Eurobot 2008 y 2010}
\label{fig_robots_topolino_y_trompetero}
\end{figure}

Trompetero (figura \ref{fig_robot_trompetero}) supuso un reto para los desarrolladores de Topolino, con el que se había alcanzado el techo de la tecnología con la que se construyó, y con Trompetero se quiso desarrollar un robot al nivel de los robots de primera linea de Eurobot. Trompetero partió de las librerías Aversive las cuales cuentan con partes del robot ya implementadas como el desplazamiento y localización. Aun así, Trompetero implicó el desarrollo de la mecánica, electrónica y del software del resto de partes, además de la migración de las librerías Aversive al HW basado en microcontroladores dsPIC33 y su aprendizaje. Trompetero tenía una mecánica compleja que abarcaba la manipulación de todos los elementos del juego de Eurobot 2010. En general un desarrollo muy ambicioso. Aunque el proceso de desarrollo de Trompetero supuso un gran aprendizaje y una evolución en el desarrollo de un robot de Eurobot, los imprevistos, la falta de tiempo y sueño hicieron que terminase en números rojos en términos de disfrute. Aunque se consiguieron desarrollar todas las partes del robot, estas tenían errores que no fueron solucionados a tiempo y al igual que la estrategia de juego. En consecuencia se consiguió una evolución a costa del disfrute.

Afortunadamente, la mayor parte del trabajo realizado en el desarrollo de Trompetero tuvo su retorno con el robot Zamorano (Eurobot 2011). Aprendida la lección, con Zamorano se volvió a la idea de una mecánica sencilla, un punto intermedio entre Topolino y Trompetero, centrando el desarrollo en la estrategia y en la optimización de la dinámica del robot. Aunque Zamorano tuvo un final amargo\footnote{Habiendo ganado el partido de cuartos de final en las finales de Eurobot en Rusia, Zamorano fue descalificado por una decisión arbitral injusta.}, consiguió cumplir los objetivos planteados por el equipo y supuso una gran satisfacción para sus desarrolladores.


\section{Desarrollo del robot de Eurobot}

A la hora de afrontar el desarrollo de un robot de Eurobot lo ideal es desarrollar las partes que forman la plataforma robótica base (ver sección \ref{sec_partes_robot_eurobot}) antes de que las reglas de la temática del año sean publicadas. En otro caso, se recomienda focalizar los esfuerzos en desarrollar primero estas partes y una mecánica y estrategia sencilla que permitan participar en la prueba.

Una vez que se dispone de las reglas del juego lo más sencillo es empezar desde el diseño de la estrategia, siguiendo con la mecánica y por último el diseño electrónico y software. De esta forma, la estrategia es la que impondrá las restricciones de la mecánica y ésta a su vez fijará las necesidades de la electrónica, y toda ellas, las necesidades del software.

El desarrollo de un robot de Eurobot se puede dividir en las siguientes fases:

\begin{enumerate}
\item Fabricación del campo de juego
\item Diseño de la estrategia de juego
\item Realización de prototipos mecánicos y pruebas de concepto
\item Diseño y fabricación de la mecánica y de la electrónica
\item Montaje del robot y cableado
\item Implementación software de la funcionalidad del robot
\item Implementación software de la estrategia de juego
\item Puesta en marcha y verificación
\end{enumerate}

En esencia, como ya se ha comentado un robot de Eurobot implica un desarrollo mecánico, electrónico y software. En cualquiera de estos es importante tener el cuenta el nivel de complejidad a desarrollar en cada caso sin perder de vista el objetivo final: un robot participante en Eurobot. Por ejemplo si centra el desarrollo en partes que que pueden considerarse básicas, como un sensor, no se estará desarrollando un robot, si no un sensor. Se ha de valorar que partes han de ser desarrolladas a medida y que partes han de ser compradas. En este aspecto el tamaño de las partes juega un papel importante ya que el espacio donde han de convivir mecánica y electrónica no suele abundar. Lo más normal es que el diseño mecánico se adapte a los motores y sensores disponibles, y la electrónica se diseñe a medida de la mecánica.  

% desde la inexperiencia... ?

\subsection{Fabricación del campo de juego}
\label{fabricacion_campo_de_juego}

Disponer de un campo de juego con todos sus elementos supone una gran ayuda en todo el proceso de desarrollo del robot, desde el diseño de la estrategia, pasando por la validación de prototipos mecánicos y hasta la fase de depuración y mejoras. El campo de juego es el entorno del robot de Eurobot y por tanto cualquier prueba ha de realizarse en él para garantizan que las condiciones van a ha ser las mismas que en otros campos de juego.

Es recomendable fabricar un campo de juego lo más parecido a como está especificado en las reglas del juego y contar con los elementos de juego reales lo antes posible.

\subsection{Diseño de la estrategia de juego}
\label{sec_diseño_estrategi_de_juego}

Diseñar una estrategia es un proceso en el que puede participar cualquier persona y la parte más divertida ya que se cuenta con recursos ilimitados: la imaginación. Aun así es de mucha utilidad contar con los elementos del juego físicos y un campo de juego de dimensiones reales. Antes de nada es necesario y recomendable leer y estudiar bien las reglas del juego. Algunos equipos suelen organizar fines de semana en los que dedican el tiempo a estudiar las reglas y diseñar la estrategia\footnote{Este tipo de actividades además ayudan a unir al equipo de Eurobot y a que sus integrantes se conozcan mejor}. La figura \ref{fig_finde_robotico} muestra el campo y elementos de juegos construidos rudimentariamente durante un fin de semana \emph{robótico} y que se utilizaron para simular las primeras estrategias de juego.

\begin{figure}[h]
\centering
\includegraphics[width=.8\textwidth]{finde_robotico}
\caption[Elementos y campo de juego utilizado para discutir las primeras estrategias de juego]{Elementos y campo de juego utilizado para discutir las primeras estrategias de juego de Eurobot 2015}
\label{fig_finde_robotico}
\end{figure}

Algunos de los factores a tener en cuenta en la estrategia son los siguientes:

\begin{description}

\item \textbf{Puntuación objetivo:}

Es la puntuación media a obtener por partido y con la que se estima ganar al oponente. Normalmente es un porcentaje de la puntuación máxima que puede obtener un equipo. El primer objetivo durante la competición es clasificarse entre los 16 primeros equipos. Durante la fase de clasificación cada equipo juega 5 partidos. La puntuación de corte que permite estar entre los 16 primeros varia con la temática de cada año y depende de la dificultad de las acciones a realizar por los robots.

\item \textbf{Compromiso puntuación vs. complejidad}

Es recomendable analizar la puntuación que supone cada elemento de juego o la tarea implicada frente a la complejidad o inconvenientes de llevarlo a cabo. Así una tarea que implique una complejidad grande y poca puntuación puede ser descartada. En cambio, aquellas tareas baja complejidad y mucha puntuación han de tener una prioridad alta. Este tipo de estudio permite determinar que tareas realizar para alcanzar una puntuación objetivo.

\item \textbf{Tiempo de partido:}

El tiempo de partido es un factor importante a tener en cuenta. Al tiempo que cada robot necesita para llegar hasta los elementos de juego hay que añadir el tiempo que los robots dedicarán a evitar las colisiones entre ellos o a bloqueos desafortunados.

\item \textbf{Tiempo que implica realizar una tarea del juego:}

No es lo mismo tener que empujar un elemento para obtener puntos que tener que cogerlo, identificarlo, clasificarlo y almacenarlo. La estimación de dicho tiempo dependerá de la experiencia de los desarrolladores, pero ha de ser acotado mediante prototipos y pruebas de concepto. 

\item \textbf{Acceso a los elementos de juego:}

Además hay que tener en cuenta cuanto de accesible es un elemento de juego. Por ejemplo si está muy cerca de las esquinas del campo, dependiendo de la forma de cada robot puede que el elemento no sea accesible o que sean necesarias muchas maniobras para llegar a él. Aunque en esta fase no se disponga del robot definitivo, es una buena idea construir uno de cartón de las dimensiones máximas especificadas por las reglas del juego. La simulación de los movimientos de este \emph{robot de cartón} sobre un campo de juego de dimensiones reales permitirá comprobar si existe algún impedimento en realizar las trayectorias o movimientos pensados en la estrategia.

\item \textbf{Trayectorias y distancias hasta los elementos de juego:}

En los desplazamientos del robot la mayor parte del tiempo se destina a acelerar y a frenar. Es interesante que un robot tenga la capacidad de manipular elementos de juego cercanos y así optimizar las trayectorias. Lo ideal es que un robot realice una trayectoria continua de forma que sin detenerse sea capa de recolectar o puntuar al pasar por las zonas de los diferentes elementos de juego como lo hacía el robot del equipo Microb en Eurobot 2010 \cite{robot_microb_2010}. Si esto no es posible, se han ha de tratar de realizar trayectorias que que permita llegar hasta los elementos del juego en el menor desplazamiento y numero de movimientos. La optimización de las trayectorias permite ahorrar mucho tiempo y disponer de más tiempo para imprevistos del juego.


\item \textbf{Caminos alternativos de estrategia:}

El tiempo en un partido de Eurobot es escaso, es por ello que un robot tiene que tratar aprovecharlo. La estrategia debe de prever que no siempre el robot va a poder hacer cierta tarea en un momento dado, es por ello que en cada momento ha de preverse un camino o tarea alternativa. Sin embargo, a veces, cuando un robot se queda atrapado entre dos paredes del campo de juego y el robot oponente no queda otra que esperar a que éste libere el paso.

\item \textbf{Riesgo de encontrarse al oponente:}

A la hora de decidir que tareas o caminos seguir se recomienda tener en cuenta la probabilidad de encontrarse al oponente en la misma zona, de forma que la tarea se vea entorpecida o ralentizada.

\item \textbf{Tareas de cada robot:}

Si el equipo está formado por dos robots hay que definir que tareas realizarán cada uno de forma que resulte ventajoso para el resultado del partido.

\end{description}


La figura \ref{fig_estrategia_2015} se representa la estrategia diseñada para Eurobot 2015 (\emph{Robomovies}). Cada equipo jugaba por un color (amarillo o verde) y se permitían hasta dos robots por equipo, los cuales al principio de partido empezaban desde la zona llamada \emph{Casa}. Cada robot podía partir con una bombilla (pelota de tenis) en su interior con la que construir un foco de cine. Se decidió crear dos robots: P.Tinto (principal) y Tirantes (secundario). 

\begin{figure}[p]
\centerline{
	\subfloat[Estrategia del robot P.Tinto)]{\includegraphics[width=.9\textwidth]{estrategia_ptinto}
	\label{fig_estrategia_ptinto}}	
}
\vfil
\vfil
\centerline{
	\subfloat[Estrategia del robot Tirantes]{\includegraphics[width=.9\textwidth]{estrategia_tirantes}
	\label{fig_estrategia_ptinto}}
}
\caption[Estrategia de los robot P.Tinto y Tirantes en Eurobot 2015]{Estrategia de los robot P.Tinto y Tirantes en Eurobot 2015. Las lineas continuas representan la estrategia principal y las lineas discontinuas caminos alternativos de estrategia.}
\label{fig_estrategia_2015}
\end{figure} 

P.Tinto saldría primero al comenzar el partido y seguiría la siguiente estrategia:

\begin{enumerate}
\item Se dirigiría hacia el \emph{vaso de palomitas} del centro del campo para recolectar las palomitas de su interior y desechar el vaso. Los vasos de palomitas eran elementos compartidos por ambos equipos, además eran un número impar por lo que el vaso central tenía mucha probabilidad de ser un elemento muy disputado. En dicho camino recolectaría los dos \emph{stands} de su color en la trayectoria. 

\item Tanto si P.Tinto fuese capaz de llegar al vaso, como si no (robot oponente más rápido) a continuación se dirigiría a cerrar la \emph{claqueta} de su color más cercana y en el camino recolectaría el \emph{stand} que hay en la trayectoria. 

\item Seguidamente P.Tinto recolectaría el \emph{vaso de palomitas} de la esquina inferior, los dos \emph{stands} y cerraría la \emph{claqueta} de al lado.

\item Si P.Tinto encontrase un camino libre y el oponente no estuviese en la esquina superior derecha, se desplazaría hacia dicha zona para llenar el \emph{vaso de palomitas} anteriormente recolectado con más palomitas y almacenar el sobrante en su interior. Posteriormente recolectaría el \emph{stand} huérfano de la esquina superior derecha y los dos situados al lado de las escalinatas.

\item P.Tinto finalizaría volviendo a la \emph{casa} donde dejaría el \emph{vaso de palomitas} y las palomitas recolectadas y construiría un foco de cine con los \emph{stands} recolectados.
\end{enumerate}

Tirantes, más pequeño y ágil sería el encargado de defender el camino hacia la esquina superior derecha y hacer tareas en el otro lado del campo:

\begin{enumerate}
\item Tirantes comenzaría el partido en la \emph{casa} detrás de P.Tinto y saldría después de él a recolectar el \emph{vaso de palomitas} cercano a las escalinatas.

\item Una vez capturado el vaso esperaría en esa posición a que P.Tinto hubiera terminado de recolectar los elementos de la zona interior. La máquina de palomitas era un elemento de juego común a ambos equipos, aunque lo más probable es que cada equipo fuese primero a recolectar palomitas de la máquina más cercana a su \emph{casa}, la posición de Tirantes ayudaría a disuadir a los robots oponentes. 

\item Posteriormente se dirigiría a poner las alfombras en sus caminos. Las alfombrar rojas eran elementos del juego que portaban los robots desde el inicio en su interior. Si la zona de dejar las alfombras no se pudiese alcanzar Tirantes esperaría un tiempo antes de continuar con otra tarea.

\item A continuación Tirantes se dirigiría a cerrar la \emph{claqueta} de su color del otro lado del campo. Si no pudiese se dirigiría a dejar el vaso de palomitas en el cine de arriba.

\item Seguidamente dejaría el vaso de palomitas en el \emph{cine} de abajo o cerraría la \emph{claqueta} que le quedaba por cerrar. Según se hubiesen desarrollado los acontecimientos.

\item Por último, Tirantes volvería a las escalinatas para subir las escaleras. Subir la escalinata era una acción de habilidad para los robots diseñados para desplazarse sobre una superficie lisa.
\end{enumerate}


En esta estrategia se definieron los caminos alternativos descritos, en cualquier caso, si el robot no pudiese alcanzar alguna zona esperaría a que las condiciones fuesen favorables.


\subsection{Realización de prototipos mecánicos y pruebas de concepto}
\label{prototipos_y_pruebas_de_concepto}

Una vez más o menos clara la estrategia es el momento de investigar sobre los sistemas mecánicos a utilizar para la manipulación de los elementos de juego. No es necesario desarrollar los sistemas definitivos que llevará el robot para saber si una idea es válida. Es suficiente el desarrollo de prototipos mecánicos para validar una idea y comprobar que el concepto en el que se basa sirve para los propósitos buscados.

Antes de nada es imprescindible contar con los elementos de juego reales, para ello, será necesario adquirirlos o fabricarlos.

Esta fase de desarrollo se basa en el concepto de \emph{prueba y error} es por ello que debería ser una fase de desarrollo muy dinámica que permite sacar conclusiones en un tiempo corto sobre el fundamento en el que luego se sustentarán los sistemas mecánicos definitivos. En un principio los prototipos suelen servir más para descartar posibles sistemas, será después de varios intentos cuando se llegará a un sistema que cumpla con los requisitos.

A la hora de desarrollar estos prototipos se recomienda plasmar las ideas sobre papel y utilizar materiales fáciles de manipular para fabricar los prototipos ideados. En función de las de las herramientas con las que se cuente, algunos de los materiales que se pueden utilizar son: madera, plástico, cartón y aluminio. La mayoría de esos materiales se puede trabajar utilizando herramientas de carpintería de madera o aluminio y de papelería. Una herramienta muy útil que recientemente se ha hecho muy popular son las impresoras 3D por aporte de plástico. Este tipo de herramienta es muy versátil ya que permite crear piezas de casi cualquier forma. Pero cuidado, si la piezas o piezas a imprimir para el prototipo son complejas el tiempo de diseño y fabricación de la mismas puede demorar esta fase del desarrollo del robot más de lo necesario.

\begin{figure}[h]
\centerline{
	\subfloat[Boceto idea turbina]{\includegraphics[width=.4\textwidth]{boceto_maquina_palomitas_1}
	\label{fig_boceto_maquina_palomitas}}	
	\hfil
	\subfloat[Prototipo idea turbina]{\includegraphics[width=.5\textwidth]{prototipo_maquina_palomitas}
	\label{fig_prototipo_maquina_palomitas}}
}
\caption[Prototipo recolección maquinas palomitas de Eurobot 2015]{Prototipo de sistema de recolección de palomitas de las maquinas de palomitas en Eurobot 2015.}
\label{fig_prototipos_maquina_palomitas}
\end{figure}

La figura \ref{fig_boceto_maquina_palomitas} muestra una de las ideas pensadas inicialmente para recolectar las palomitas de las maquinas de palomitas en Eurobot 2015. Esta se fundamentaba en utilizar una turbina para aspirar las pelotas de poliestireno (palomitas) y almacenarlas en columnas verticales y el exceso de palomitas en un vaso. La figura \ref{fig_prototipo_maquina_palomitas} muestra uno de los prototipos realizados para la validación de la idea, este esta realizado a partir de un cartón de zumo, una botella de plástico y una turbina.


\begin{figure}[h]
\centerline{
	\subfloat[Diseño CAD (vista frontal)]{\includegraphics[width=.45\textwidth]{sistema_maquina_palomitas_cad}
	\label{fig_sistema_maquina_palomitas_cad}}	
	\hfil
	\subfloat[Sistema real (vista desde arriba)]{\includegraphics[width=.45\textwidth]{sistema_maquina_palomitas_real}
	\label{fig_sistema_maquina_palomitas_real}}
}
\caption[Sistema de recolección maquinas palomitas de Eurobot 2015]{Sistema desarrollado para la recolección de palomitas de las máquinas de palomitas en Eurobot 2015.}
\label{fig_sistema_maquina_palomitas}
\end{figure}

Ninguna de estas ideas fueron las que se llevaron a cabo, pero la idea final si que contenía elementos de estas. El sistema final se muestra en la figura \ref{fig_sistema_maquina_palomitas}, dos brazos con forma de rampa empujan la primera pelota de los tubos donde se encuentran almacenadas las palomitas (máquina de palomitas). Una vez desplazada la primera pelota el resto de pelotas caen libres hacia dos compartimentos y un vaso de palomitas en el interior del robot P.Tinto.


\subsection{Diseño y fabricación de la mecánica y de la electrónica}
\label{sec_diseño_y_fabricacion_mecanica_electronica}

Una vez validados los diferentes sistemas mecánicos del robot mediante prototipos o pruebas de concepto, es el momento de realizar un diseño conjunto del robot. Dependiendo del caso la electrónica necesaria para controlar la mecánica puede ser realizada a medida o mediante la integración de tarjetas desarrolladas anteriormente o comerciales. En el primer caso, la electrónica se podrá diseñar a medida de la mecánica de forma que se situé en los huecos libres, o en el segundo caso, la electrónica deberá ser tenida en cuenta como un componente más. En cualquier caso el diseño mecánico y de la electrónica han de realizarse de forma sincronizada. 

El diseño mecánico del robot no sólo ha centrarse en su funcionalidad, hay otros factores a tener en cuenta como la accesibilidad a los elementos, la facilidad de montaje y desmontaje, y el cableado de los elementos electrónicos. El robot a desarrollar no es otra cosas que un prototipo más o menos elaborado, es por ello que durante su desarrollo y en la competición de Eurobot es inevitable que existan fallos de diseño o averías. En estos casos, una mecánica modular que permita acceder de forma sencilla e independiente a las diferentes partes del robot permitirá realizar reparaciones o modificaciones con un desmontaje mínimo y en poco tiempo.


\subsection{Montaje del robot y cableado}
\label{sec_montaje_robot_y_cableado}

El montaje del robot y el cableado de los componentes electrónicos es una parte importante que no debe de ser subestimada. El tiempo de montaje puede llevar más o menos tiempo dependiendo de si durante la fase de diseño mecánico del robot se tuvo en cuenta como requisito la facilidad de montaje y desmontaje, y del número de piezas del que esté compuesto el robot. Así mismo la labor de cableado se simplificará si también en la fase de diseño mecánico se tuvo en cuenta el camino destinado a cables y conectores. 

El cableado ha de ser claro, ordenado, gerarquico y respetando la coca de los cables utilizados. Las fijaciones de estos a la mecánica han de ser las mínimas necesarias de forma que los cables tengan cierto grado de libertad, un numero excesivo de fijaciones puede hacer que los cables se tensen o retuerzan debido al movimiento de las partes mecánicas móviles, o que en caso de reparación, la eliminación de la fijaciones supusiera un tiempo excesivo.


\subsection{Implementación software de las funcionalidades del robot}
\label{sec_implementacion_funcionalidad_del_robot}

Esta fase tiene como resultado un robot de Eurobot totalmente funcional, esto es, capacitado para competir en una prueba específica. Este es el punto que idealmente se debería alcanzar lo antes posible, una vez finalizado es como tener un \emph{juguete} con el que divertirse diseñando estrategias de juego. 

Hay que resaltar que una vez alcanzado este punto tan sólo el 20\% del desarrollo del robot estará terminado, el 80\% restante se corresponde al desarrollo software, la puesta en marcha y pruebas del robot el campo de juego.

La funcionalidad del robot es un nivel de abstracción que permite controlar el robot con funciones del tipo: 

\begin{itemize}
\item ¿Está el oponente en la zona X?
\item Ir a la zona de recolección del elemento X.
\item Recolectar elemento X.
\item Ir a la zona de almacenamiento X.
\item Almacenar el elemento X.
\end{itemize}


Son varias las partes de un robot de Eurobot (ver sección \ref{sec_partes_robot_eurobot}) implicadas en su funcionalidad:

\begin{enumerate}
\item Desplazamiento y localización
\item Evitación de obstáculos
\item Comunicación entre robots
\item Manipulación de elementos de juego
\end{enumerate}

Las tres primeras pertenecen a lo que se ha denominado plataforma robótica base (partes independientes de la temática de Eurobot), si estas han sido desarrolladas con anterioridad sólo necesitarán de modificaciones relacionadas con aspectos específicos de la temática del juego como pueden ser:

\begin{itemize}
\item Obstáculos fijos del campo de juegos
\item Comandos de la comunicación entre los robots compañeros
\end{itemize}


Respecto a la última parte, está necesita ser desarrollada casi en su totalidad al depender enteramente de los sistemas mecánicos diseñados expresamente para una prueba concreta.

\subsection{Implementación software de la estrategia de juego}
\label{sec_implementación_estrategia_de_juego}

La implementación de la estrategia supone ciertas funcionalidades del robot de Eurobot, entre ellas el desplazamiento y localización, la capacidad para manipular los elementos de juego y la detección de obstáculos y oponentes. Además, en caso de jugar con dos robots puede tener en cuenta las funcionalidades de ambos.

Un desarrollo software estratificado y modular permitirá implementar la estrategia de forma paralela al desarrollo del resto de las partes robot. La estrategia constituye la inteligencia del robot, siendo algunas de sus características deseables las siguientes:

\begin{description}
\item \textbf{Robusted:}\\
Una estrategia suele tener varias ramificaciones dependiendo de las condiciones en cada momento. Cada uno de los posibles caminos han de volver siempre al camino principal de forma que no existan bloqueos o zonas muertas en la estrategia. Para ello, cada uno de los caminos implementados ha de estar probado para evitar dichas zonas muertas. Pero además, durante un partido de Eurobot se pueden dar situaciones muy diferentes dependiendo de la estrategia de los robots oponentes y del azar. 

Una buena previsión de dichas situaciones evitará también bloqueos de la estrategia. Por ejemplo, la situación en la que un robot quiere llegar a una zona a la que se llega por dos caminos y uno esta ocupado por el oponente y el otro por el robot secundario. Si no se ha tenido en cuenta esta situación de forma que el robot secundario libere el camino, la estrategia de partido puede quedar bloqueada hasta el final del partido y los robots no podrían sumar los puntos suficientes para ganar el partido\footnote{Caso verídico por el cual los robots Crispín y Automático quedaron eliminados en cuartos de final en Eurobot 2012}.


\item \textbf{Facilidad de modificación y flexibilidad:}\\
La estrategia dota de cierta inteligencia al robot que le permite ejecutarla de forma autónoma. Pero igual que un entrenador de baloncesto da dirige a sus jugadores para seguir una estrategia concreta o adaptarla al contrincante, el equipo de desarrolladores han de poder hacer lo mismo con su robot de Eurobot. Así la implementación de la estrategia tiene que tener la flexibilidad suficiente para poder ejecutar variantes de esta o realizar modificaciones en tiempo real. 


\item \textbf{Ejecución simulada:}\\
La estrategia puede tener múltiples ramificaciones y variantes, y su ejecución en cada momento depende de múltiples variables, entre ellas variables dependientes del oponente. Las pruebas en el campo de juego implica reproducir cada momento y sus variables, necesita de uno o varios robots operativos y o varias personas que simulen el movimiento de robots oponentes. 

Por todo ello, poder ejecutar y probar la estrategia en un entorno simulado constituye una característica de mucha utilidad. Un entorno de simulación software permite reproducir todas las variables de las que depende la estrategia en todo momento a un coste mucho menor que las pruebas realizadas en el campo de juego real con robots reales. De esta forma la verificación de la estrategia o modificaciones de esta supone muchos menos recursos y tiempo.


\end{description}

\subsection{Puesta en marcha y verificación}
\label{sec_puesta_en_marcha_y_verificacion}

La puesta en marcha y verificación constituye la fase más importante si cabe de todas. Cada parte a desarrollar o mejorar del robot ha de ser probada en condiciones reales y verificada de forma que se asegure una repetitividad en su funcionamiento. Esto es así tanto para partes mecánicas y electrónicas, como para el funcionamiento software. Así pues esta es una fase implícita en cualquiera de las otras fases o partes a desarrollar de un robot de Eurobot.

Es recomendable realizar un desarrollo modular y estratificado desde los niveles más bajos y específicos hacia los más altos y abstractos. De esta forma cada parte desarrollada ha de contar con funciones o herramientas que permitan probar de forma independiente su funcionamiento y verifícalo. Si además dichas funciones de test están accesibles durante todo el proceso de desarrollo pueden ser útiles para la depuración de funciones más abstractas o de averías relacionadas con el cableado o componentes electrónicos. Por ejemplo, en caso de fallo en un actuador tipo servomotor una función que permita mover dicho actuador a nivel de driver de señal PWM puede ayudar a verificar si el fallo es del actuador o de capas superiores al driver. O por ejemplo una función que permita comprobar el estado de los sensores digitales permitirá comprobar si hay un fallo en algún sensor o el cableado. 

Por otro lado, aunque el funcionamiento del robot este verificado es inevitable que durante los partidos surjan incompatibilidades en ciertas partes del desarrollo o funcionalidades que pueden ser mejoradas. Durante las competiciones, los partidos constituyen el mejor entorno de pruebas y son la mejor forma de pulir el funcionamiento y perfeccionar la estrategia del robot. Si es posible, se recomienda no limitarse a participar en la competición nacional del país de origen y participar en otras copas de Eurobot abiertas a participantes de otros países.
%%% Local Variables:
%%% TeX-master: "../book"
%%% End:
